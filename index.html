<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>èª­æ›¸æ‰‹å¸³ â€” Japanese Reading Companion</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;700&family=Crimson+Pro:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">

<link rel="stylesheet" href="styles.css">

</head>

<body>
<header class="topbar">
  <div class="topbar-left">
    <h1>ç©èª­ãƒ•ãƒ¬ãƒ³ãƒ‰ <span class="heart">â™¡</span></h1>
  </div>

  <div class="topbar-right">
    <span class="tagline">Japanese Reading Companion</span>

    <div class="theme-dots" aria-label="Theme">
      <button class="theme-dot" type="button" data-theme="flowers" aria-label="Flowers theme"
        title="Flowers" style="--dot:#CAC4F6"></button>
      <button class="theme-dot" type="button" data-theme="joyful" aria-label="Joyful theme"
        title="Joyful" style="--dot:#ffa5c8"></button>
      <button class="theme-dot" type="button" data-theme="plum" aria-label="Plum theme"
        title="Plum" style="--dot:#AF6384"></button>
    </div>
  </div>
</header>

<nav>
  <button class="active" onclick="showPanel('lookup', this)">ğŸ” Lookup</button>
  <button onclick="showPanel('lists', this)">ğŸ“š Word Lists</button>
  <button onclick="showPanel('writing', this)">âœï¸ Handwrite</button>
  <button onclick="showPanel('radicals', this)">éƒ¨é¦– Radicals</button>
  <button onclick="showPanel('flashcards', this)">ğŸƒ Flashcards</button>
</nav>

<main>
  <!-- â”€â”€ LOOKUP PANEL â”€â”€ -->
  <div class="panel active" id="panel-lookup">
    <div class="lookup-grid">
      <div class="card">
        <h2>Word Search â€” å˜èªæ¤œç´¢</h2>
        <div class="search-bar">
          <input id="search-input" type="text" placeholder="Enter kanji, kana, or romajiâ€¦" autocomplete="off" />
          <button class="btn" onclick="lookupWord()">Search</button>
        </div>
        <div id="results"><p class="status-msg">Search for any Japanese word above.</p></div>
      </div>
      <div class="card">
        <h2>Quick Notes â€” ãƒ¡ãƒ¢</h2>
        <textarea id="quick-notes"
          style="width:100%;min-height:200px;font-family:'Noto Serif JP',serif;font-size:0.95rem;line-height:1.9;padding:12px;border:1px solid var(--border);background:var(--paper);outline:none;resize:vertical;border-radius:2px;background-image:repeating-linear-gradient(transparent,transparent 30px,var(--aged) 30px,var(--aged) 31px)"
          placeholder="Jot down notes, sentences, contextâ€¦"></textarea>
      </div>
    </div>
  </div>

  <!-- â”€â”€ WORD LISTS PANEL â”€â”€ -->
  <div class="panel" id="panel-lists">
    <div class="lists-layout">
      <div>
        <div class="card" style="margin-bottom:0">
          <h2>Books â€” æœ¬</h2>
          <div class="new-book-form">
            <input id="new-book-input" type="text" placeholder="Book titleâ€¦" onkeydown="if(event.key==='Enter')addBook()" />
            <button class="btn btn-sm" onclick="addBook()">+</button>
          </div>
          <div class="book-list" id="book-list"></div>
        </div>
      </div>
      <div class="card">
        <h2 id="list-title">Word List â€” å˜èªãƒªã‚¹ãƒˆ</h2>
        <div id="word-list-content"><p class="empty-state">Select or create a book to see its word list.</p></div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ HANDWRITE PANEL â”€â”€ -->
  <div class="panel" id="panel-writing">
    <div class="writing-layout writing-two">
      <div class="card canvas-wrap">
        <h2>Handwrite Kanji â€” æ‰‹æ›¸ãæ¤œç´¢ (1)</h2>
        <canvas id="writing-canvas-1" width="420" height="350"></canvas>

        <div class="canvas-controls">
          <div class="brush-row">
            <span>Size</span>
            <input type="range" id="brush-size" min="1" max="40" value="10" />
            <input type="color" id="brush-color" value="#1a1410" />
          </div>
          <button class="btn btn-sm btn-outline" onclick="hwClear(1)">Clear</button>
          <button class="btn btn-sm" onclick="hwRecognize(1)">Recognize</button>
        </div>

        <div class="candidate-row" id="hw-candidates-1"></div>
        <p class="status-msg" id="hw-status-1">Draw a kanji, then click Recognize.</p>
      </div>

      <div class="card canvas-wrap">
        <h2>Handwrite Kanji â€” æ‰‹æ›¸ãæ¤œç´¢ (2)</h2>
        <canvas id="writing-canvas-2" width="420" height="350"></canvas>

        <div class="canvas-controls">
          <div class="brush-row">
            <span>Size</span>
            <!-- shares brush controls -->
          </div>
          <button class="btn btn-sm btn-outline" onclick="hwClear(2)">Clear</button>
          <button class="btn btn-sm" onclick="hwRecognize(2)">Recognize</button>
        </div>

        <div class="candidate-row" id="hw-candidates-2"></div>
        <p class="status-msg" id="hw-status-2">You can write a second kanji to build multi-kanji words.</p>
      </div>

      <div class="card hw-build">
        <h2>Build Word â€” çµ„ã¿åˆã‚ã›</h2>
        <p class="radical-info">Click a candidate above to add it. You can edit the field manually too.</p>
        <div class="search-bar">
          <input id="hw-query" type="text" placeholder="ä¾‹: æ—¥æœ¬ / çŒ« / ä¸€" autocomplete="off" />
          <button class="btn" onclick="hwLookup()">Search</button>
          <button class="btn btn-outline" onclick="hwClearQuery()">Clear</button>
        </div>
        <div id="hw-word-suggestions"><p class="status-msg">Write kanji (or type) to see word suggestions.</p></div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ RADICALS PANEL â”€â”€ -->
  <div class="panel" id="panel-radicals">
    <div class="radical-layout">
      <div class="card">
        <h2>Radical Picker â€” éƒ¨é¦–</h2>
        <p class="radical-info">Select one or more radicals to find kanji. Results come from Jisho.</p>
        <div class="stroke-filter" id="stroke-filter"></div>
        <div class="radical-grid" id="radical-grid"></div>
      </div>
      <div class="card">
        <h2>Selected Radicals</h2>
        <div class="selected-radicals" id="selected-radicals-display">â€”</div>

        <div class="search-bar" style="margin-top:10px;margin-bottom:14px">
          <input id="radical-kanji-input" type="text" placeholder="Kanji found via radicalsâ€¦ (click candidates to add)" autocomplete="off">
          <button class="btn" onclick="radicalLookup()">Search</button>
          <button class="btn btn-outline" onclick="clearRadicals()">Clear</button>
        </div>

        <div id="radical-candidates" class="candidate-row"></div>
        <p class="status-msg" id="radical-status">Select radicals, then click â€œGet Kanjiâ€.</p>

        <div style="display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 14px">
          <button class="btn btn-sm" onclick="searchByRadicals()">Get Kanji</button>
          <button class="btn btn-sm btn-outline" onclick="clearRadicalQuery()">Clear input</button>
        </div>

        <div id="radical-word-suggestions"><p class="status-msg">Pick kanji (or type) to see word suggestions.</p></div>
      </div></div>
    </div>
  </div>

  <!-- â”€â”€ FLASHCARDS PANEL â”€â”€ -->
  <div class="panel" id="panel-flashcards">
    <div class="fc-setup" id="fc-setup">
      <div class="card">
        <h2>Study Session â€” å‹‰å¼·</h2>
        <p style="font-size:0.9rem;color:var(--muted);margin-bottom:16px;font-style:italic">
          Choose which book(s) to study, then configure your session.
        </p>
        <p style="font-size:0.85rem;color:var(--muted);margin-bottom:8px;letter-spacing:0.05em">BOOKS</p>
        <div class="fc-book-grid" id="fc-book-grid"></div>
        <div class="fc-options">
          <div class="fc-option-row">
            <label>Show</label>
            <select id="fc-mode">
              <option value="kanji-to-meaning">Kanji â†’ Meaning</option>
              <option value="meaning-to-kanji">Meaning â†’ Kanji</option>
              <option value="reading-to-meaning">Reading â†’ Meaning</option>
            </select>
          </div>
          <div class="fc-option-row">
            <label>Order</label>
            <select id="fc-order">
              <option value="random">Random</option>
              <option value="sequential">Sequential</option>
              <option value="hard-first">Hard first</option>
            </select>
          </div>
          <div class="fc-option-row">
            <label>Limit</label>
            <select id="fc-limit">
              <option value="0">All cards</option>
              <option value="10">10 cards</option>
              <option value="20">20 cards</option>
              <option value="30">30 cards</option>
              <option value="50">50 cards</option>
            </select>
          </div>
        </div>
      </div>
      <div style="text-align:center">
        <button class="btn" style="padding:12px 36px;font-size:1.1rem;letter-spacing:0.1em" onclick="startFlashcards()">Start Study é–‹å§‹</button>
      </div>
    </div>

    <div class="fc-study" id="fc-study">
      <div class="fc-progress-bar-wrap">
        <span id="fc-count">0 / 0</span>
        <div class="fc-progress-bar"><div class="fc-progress-fill" id="fc-progress-fill" style="width:0%"></div></div>
        <button class="btn btn-sm btn-outline" onclick="endSession()">End</button>
      </div>

      <div class="fc-session-stats">
        <div class="fc-stat"><span class="val" id="stat-again">0</span>Again</div>
        <div class="fc-stat"><span class="val" id="stat-hard">0</span>Hard</div>
        <div class="fc-stat"><span class="val" id="stat-good">0</span>Good</div>
        <div class="fc-stat"><span class="val" id="stat-easy">0</span>Easy</div>
      </div>

      <div class="fc-card-scene" id="fc-card-scene" onclick="flipCard()">
        <div class="fc-card-inner" id="fc-card-inner">
          <div class="fc-card-face fc-front">
            <div class="fc-hint" id="fc-front-hint">KANJI</div>
            <div class="fc-word" id="fc-front-word">â€”</div>
            <div class="fc-reading-front" id="fc-front-sub"></div>
            <div class="fc-tap-hint">tap to reveal</div>
          </div>
          <div class="fc-card-face fc-back">
            <div class="fc-hint">ANSWER</div>
            <div class="fc-word-back" id="fc-back-word"></div>
            <div class="fc-meaning-back" id="fc-back-meaning"></div>
            <div class="fc-reading-back" id="fc-back-reading"></div>
          </div>
        </div>
      </div>

      <div class="fc-ratings" id="fc-ratings">
        <button class="fc-rating-btn fc-btn-again" onclick="rateCard('again')">
          <span class="label">Again</span><span class="sub">ã‚‚ã†ä¸€åº¦</span>
        </button>
        <button class="fc-rating-btn fc-btn-hard" onclick="rateCard('hard')">
          <span class="label">Hard</span><span class="sub">é›£ã—ã„</span>
        </button>
        <button class="fc-rating-btn fc-btn-good" onclick="rateCard('good')">
          <span class="label">Good</span><span class="sub">ã‚ã‹ã£ãŸ</span>
        </button>
        <button class="fc-rating-btn fc-btn-easy" onclick="rateCard('easy')">
          <span class="label">Easy</span><span class="sub">ç°¡å˜</span>
        </button>
      </div>
      <div class="fc-shortcuts">Space / Enter = flip &nbsp;|&nbsp; 1 Again &nbsp; 2 Hard &nbsp; 3 Good &nbsp; 4 Easy</div>
    </div>

    <div class="fc-results" id="fc-results">
      <div class="fc-results-title">Session Complete å®Œäº†</div>
      <div class="fc-results-grid" id="fc-results-grid"></div>
      <div class="fc-again-list" id="fc-again-list" style="display:none">
        <h3>Review Again â€” è¦å¾©ç¿’</h3>
        <div id="fc-again-items"></div>
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
        <button class="btn" onclick="restartSession()">Study Again</button>
        <button class="btn btn-outline" onclick="backToSetup()">Change Settings</button>
      </div>
    </div>
  </div>
</main>

<script src="state.js" defer></script>
<script src="nav.js" defer></script>
<script src="lookup.js" defer></script>
<script src="books.js" defer></script>
<script src="handwriting.js" defer></script>
<script src="radicals.js" defer></script>
<script src="flashcards.js" defer></script>
<script src="init.js" defer></script>
</body></html>